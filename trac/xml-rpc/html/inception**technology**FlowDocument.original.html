<html><body><h1 id="FlowDocument:rich-textrendererandeditor">FlowDocument: rich-text renderer and editor</h1>
<p>
Part of .NET WPF (Windows Presentation Foundation)
</p>
<p>
A rich-text viewer can be created programmatically, or by
loading a XAML file directly.
</p>
<p>
<div class="system-message"><strong>Error: Macro Image(FlowDocument_RTL_1.png) failed</strong><pre>Cannot reference local attachment from here</pre></div>
</p>
<p>
<div class="system-message"><strong>Error: Macro Image(FlowDocument_RTL_2.png) failed</strong><pre>Cannot reference local attachment from here</pre></div>
</p>
<p>
<a style="padding:0; border:none" href="http://static.fortes.com/2005/10/number-substitution/number-substitution.gif"><img src="http://static.fortes.com/2005/10/number-substitution/number-substitution.gif" alt="http://static.fortes.com/2005/10/number-substitution/number-substitution.gif" title="http://static.fortes.com/2005/10/number-substitution/number-substitution.gif" /></a>
</p>
<p>
<a style="padding:0; border:none" href="http://www.xtabvbcity.plus.com/Blogs/FlowDoc1.jpg"><img src="http://www.xtabvbcity.plus.com/Blogs/FlowDoc1.jpg" alt="http://www.xtabvbcity.plus.com/Blogs/FlowDoc1.jpg" title="http://www.xtabvbcity.plus.com/Blogs/FlowDoc1.jpg" /></a>
</p>
<p>
<a style="padding:0; border:none" href="http://www.tmssoftware.com/Images/xv.png"><img src="http://www.tmssoftware.com/Images/xv.png" alt="http://www.tmssoftware.com/Images/xv.png" title="http://www.tmssoftware.com/Images/xv.png" /></a>
</p>
<p>
<a style="padding:0; border:none" href="http://blog.kirupa.com/images/kWordpadFinished_ABC9/kWordpad_ss22.png"><img src="http://blog.kirupa.com/images/kWordpadFinished_ABC9/kWordpad_ss22.png" alt="http://blog.kirupa.com/images/kWordpadFinished_ABC9/kWordpad_ss22.png" title="http://blog.kirupa.com/images/kWordpadFinished_ABC9/kWordpad_ss22.png" /></a>
</p>
<p>
<a style="padding:0; border:none" href="http://dotnetslackers.com/images/ArticleImages/FlowDocumentReaderMultipleColumns.jpg"><img src="http://dotnetslackers.com/images/ArticleImages/FlowDocumentReaderMultipleColumns.jpg" alt="http://dotnetslackers.com/images/ArticleImages/FlowDocumentReaderMultipleColumns.jpg" title="http://dotnetslackers.com/images/ArticleImages/FlowDocumentReaderMultipleColumns.jpg" /></a>
</p>
<p>
<a style="padding:0; border:none" href="http://daron.yondem.com/tr/content/binary/20102007_4.png"><img src="http://daron.yondem.com/tr/content/binary/20102007_4.png" alt="http://daron.yondem.com/tr/content/binary/20102007_4.png" title="http://daron.yondem.com/tr/content/binary/20102007_4.png" /></a>
</p>
<p>
<a style="padding:0; border:none" href="http://www.xtabvbcity.plus.com/Blogs/FlowDoc1.jpg"><img src="http://www.xtabvbcity.plus.com/Blogs/FlowDoc1.jpg" alt="http://www.xtabvbcity.plus.com/Blogs/FlowDoc1.jpg" title="http://www.xtabvbcity.plus.com/Blogs/FlowDoc1.jpg" /></a>
</p>
<p>
[[Image(<a class="ext-link" href="http://www.scottgu.com/blogposts/readers/step0.jpg"><span class="icon">http://www.scottgu.com/blogposts/readers/step0.jpg</span></a>))]
</p>
<p>
[[Image(<a class="ext-link" href="http://www.scottgu.com/blogposts/readers/step1.jpg"><span class="icon">http://www.scottgu.com/blogposts/readers/step1.jpg</span></a>))]
</p>
<p>
[[Image(<a class="ext-link" href="http://www.scottgu.com/blogposts/readers/step2.jpg"><span class="icon">http://www.scottgu.com/blogposts/readers/step2.jpg</span></a>))]
</p>
<p>
[[Image(<a class="ext-link" href="http://www.scottgu.com/blogposts/readers/step5.jpg"><span class="icon">http://www.scottgu.com/blogposts/readers/step5.jpg</span></a>))]
</p>
<p>
<a class="ext-link" href="http://www.devcity.net/Articles/351/1/article.aspx"><span class="icon">http://www.devcity.net/Articles/351/1/article.aspx</span></a> <a class="ext-link" href="http://www.devcity.net/PrintArticle.aspx?ArticleID=351"><span class="icon">http://www.devcity.net/PrintArticle.aspx?ArticleID=351</span></a>
</p>
<p>
Examples here:
</p>
<p>
<a class="ext-link" href="http://www.codeproject.com/KB/WPF/OpenFlowDoc.aspx"><span class="icon">http://www.codeproject.com/KB/WPF/OpenFlowDoc.aspx</span></a>
</p>
<p>
Accessibility:
</p>
<p>
<a class="ext-link" href="http://msdn.microsoft.com/en-us/library/ms753388(VS.85).aspx"><span class="icon">http://msdn.microsoft.com/en-us/library/ms753388(VS.85).aspx</span></a>
</p>
<p>
Built-in Annotations framework !
</p>
<p>
<a class="ext-link" href="http://msdn.microsoft.com/en-us/library/ms748864.aspx"><span class="icon">http://msdn.microsoft.com/en-us/library/ms748864.aspx</span></a>
</p>
<p>
<a class="ext-link" href="http://blogs.microsoft.co.il/blogs/tamir/archive/2007/05/29/WPF-_2B00_-UISpy-_3D00_-Accessibility-testing.aspx"><span class="icon">http://blogs.microsoft.co.il/blogs/tamir/archive/2007/05/29/WPF-_2B00_-UISpy-_3D00_-Accessibility-testing.aspx</span></a>
</p>
<p>
Internal Architecture (<a class="missing wiki" href="http://daisy-trac.cvsdude.com/tobi/wiki/FrameworkElement" rel="nofollow">FrameworkElement?</a> vs. <a class="missing wiki" href="http://daisy-trac.cvsdude.com/tobi/wiki/FrameworkContentElement" rel="nofollow">FrameworkContentElement?</a>):
</p>
<p>
<a class="ext-link" href="http://wpfdisciples.wordpress.com/2008/10/09/frameworkelement-vs-frameworkcontentelement/"><span class="icon">http://wpfdisciples.wordpress.com/2008/10/09/frameworkelement-vs-frameworkcontentelement/</span></a>
</p>
<p>
Multithreading:
</p>
<p>
<a class="ext-link" href="http://chrismylonas.blogspot.com/2007/12/flowdocument-and-multiple-threads.html"><span class="icon">http://chrismylonas.blogspot.com/2007/12/flowdocument-and-multiple-threads.html</span></a>
</p>
<p>
Search algorithm and text range selection:
</p>
<p>
<a class="ext-link" href="http://shevaspace.spaces.live.com/blog/cns!FD9A0F1F8DD06954!638.entry"><span class="icon">http://shevaspace.spaces.live.com/blog/cns!FD9A0F1F8DD06954!638.entry</span></a>
</p>
<p>
<a class="ext-link" href="http://shevaspace.blogspot.com/2007/11/how-to-search-text-in-wpf-flowdocument.html"><span class="icon">http://shevaspace.blogspot.com/2007/11/how-to-search-text-in-wpf-flowdocument.html</span></a>
</p>
<p>
<a class="ext-link" href="http://blogs.microsoft.co.il/blogs/tamir/archive/2008/05/12/search-and-highlight-any-text-on-wpf-rendered-page.aspx"><span class="icon">http://blogs.microsoft.co.il/blogs/tamir/archive/2008/05/12/search-and-highlight-any-text-on-wpf-rendered-page.aspx</span></a>
</p>
<p>
<a class="ext-link" href="http://forums.microsoft.com/MSDN/ShowPost.aspx?PostID=3258597&amp;SiteID=1"><span class="icon">http://forums.microsoft.com/MSDN/ShowPost.aspx?PostID=3258597&amp;SiteID=1</span></a>
</p>
<p>
The RichTextBox editor control is limited compared to FlowDocument, but
I think that the data binding with the Urakawa-SDK data model would work
the same way, because the underlying document is a fully-fledged
FlowDocument (only the GUI is limited):
</p>
<p>
<a class="ext-link" href="http://msdn2.microsoft.com/en-us/library/aa970779.aspx"><span class="icon">http://msdn2.microsoft.com/en-us/library/aa970779.aspx</span></a>
</p>
<p>
The common content model is described here:
</p>
<p>
<a class="ext-link" href="http://msdn2.microsoft.com/en-us/library/aa970786.aspx"><span class="icon">http://msdn2.microsoft.com/en-us/library/aa970786.aspx</span></a>
</p>
<p>
Here's some additional source-code, to illustrate how to parse a FlowDocument programmatically:
</p>
<p>
<a class="ext-link" href="http://www.openxml.biz/OpenXMLWriter.html"><span class="icon">http://www.openxml.biz/OpenXMLWriter.html</span></a>
</p>
<p>
Also, here's a link to the Data Binding documentation for WPF (which should greatly simplify the linkage from GUI to Urakawa-SDK):
</p>
<p>
<a class="ext-link" href="http://msdn2.microsoft.com/en-us/library/ms752347.aspx"><span class="icon">http://msdn2.microsoft.com/en-us/library/ms752347.aspx</span></a> 
</p>
<p>
More food for thoughts:
</p>
<p>
I found a link to the text-selection architecture:
</p>
<p>
<a class="ext-link" href="http://msdn2.microsoft.com/en-us/library/system.windows.documents.textselection.aspx"><span class="icon">http://msdn2.microsoft.com/en-us/library/system.windows.documents.textselection.aspx</span></a>
</p>
<p>
A great example of how to implement the GoF Command Design Pattern in a WPF rich-text editor:
</p>
<p>
<a class="ext-link" href="http://www.codeproject.com/KB/WPF/ExtendedWPFCommands.aspx"><span class="icon">http://www.codeproject.com/KB/WPF/ExtendedWPFCommands.aspx</span></a>
</p>
<p>
<a class="ext-link" href="http://www.codeproject.com/KB/WPF/WpfCommandPatternApplied.aspx"><span class="icon">http://www.codeproject.com/KB/WPF/WpfCommandPatternApplied.aspx</span></a> 
</p>
<p>
Switching between read-only TextBlock and editable TextBox based on mouse behaviour:
</p>
<p>
<a class="ext-link" href="http://blog.paranoidferret.com/index.php/2008/10/02/wpf-tutorial-getting-the-doubleclick-event/"><span class="icon">http://blog.paranoidferret.com/index.php/2008/10/02/wpf-tutorial-getting-the-doubleclick-event/</span></a>
</p>
<p>
More links:
</p>
<p>
<a class="ext-link" href="http://hashbucket.wordpress.com/2007/09/04/building-a-simple-text-editor/"><span class="icon">http://hashbucket.wordpress.com/2007/09/04/building-a-simple-text-editor/</span></a>
</p>
<p>
<a class="ext-link" href="http://forums.microsoft.com/MSDN/ShowPost.aspx?PostID=3092330&amp;SiteID=1"><span class="icon">http://forums.microsoft.com/MSDN/ShowPost.aspx?PostID=3092330&amp;SiteID=1</span></a>
</p>
<p>
<a class="ext-link" href="http://forums.microsoft.com/MSDN/ShowPost.aspx?PostID=2197339&amp;SiteID=1"><span class="icon">http://forums.microsoft.com/MSDN/ShowPost.aspx?PostID=2197339&amp;SiteID=1</span></a>
</p>
<p>
<a class="ext-link" href="http://blog.spencen.com/2008/01/19/html-to-flowdocument-converter.aspx"><span class="icon">http://blog.spencen.com/2008/01/19/html-to-flowdocument-converter.aspx</span></a>
</p>
<p>
<a class="ext-link" href="http://blog.spencen.com/2008/04/23/handling-images-with-the-htmltoxamlconverter.aspx"><span class="icon">http://blog.spencen.com/2008/04/23/handling-images-with-the-htmltoxamlconverter.aspx</span></a>
</p>
<p>
<a class="ext-link" href="http://dedjo.blogspot.com/2008/04/wordml-to-flowdocument-how-to-convert.html"><span class="icon">http://dedjo.blogspot.com/2008/04/wordml-to-flowdocument-how-to-convert.html</span></a>
</p>
<p>
<a class="ext-link" href="http://blogs.microsoft.co.il/blogs/tamir/archive/2008/04/17/converting-fixeddocument-xpsdocument-too-to-flowdocument.aspx"><span class="icon">http://blogs.microsoft.co.il/blogs/tamir/archive/2008/04/17/converting-fixeddocument-xpsdocument-too-to-flowdocument.aspx</span></a>
</p>
<p>
<a class="ext-link" href="http://dedjo.blogspot.com/2008/04/converting-fixeddocument-xpsdocument.html"><span class="icon">http://dedjo.blogspot.com/2008/04/converting-fixeddocument-xpsdocument.html</span></a>
</p>
<p>
<a class="ext-link" href="http://blogs.msdn.com/llobo/archive/2007/06/05/wpf-blog-writer.aspx"><span class="icon">http://blogs.msdn.com/llobo/archive/2007/06/05/wpf-blog-writer.aspx</span></a>
</p>
<p>
<a class="ext-link" href="http://www.devx.com/dotnet/Article/34644"><span class="icon">http://www.devx.com/dotnet/Article/34644</span></a>
</p>
<p>
<a class="ext-link" href="http://blogs.msdn.com/jfoscoding/archive/2006/01/14/512825.aspx"><span class="icon">http://blogs.msdn.com/jfoscoding/archive/2006/01/14/512825.aspx</span></a>
</p>
<p>
<a class="ext-link" href="http://blogs.msdn.com/jfoscoding/archive/2006/01/16/513383.aspx"><span class="icon">http://blogs.msdn.com/jfoscoding/archive/2006/01/16/513383.aspx</span></a>
</p>
<p>
Embed any UIElement inside BlockUIContainer or InlineUIContainer as components of a <a class="missing wiki" href="http://daisy-trac.cvsdude.com/tobi/wiki/FlowDocument" rel="nofollow">FlowDocument?</a> (<a class="missing wiki" href="http://daisy-trac.cvsdude.com/tobi/wiki/WavForm" rel="nofollow">WavForm?</a> preview or even with some editing capabilities, or action buttons next to each phrase for direct editing, etc.)
</p>
<p>
<a class="ext-link" href="http://forums.microsoft.com/MSDN/ShowPost.aspx?PostID=1579232&amp;SiteID=1&amp;pageid=0"><span class="icon">http://forums.microsoft.com/MSDN/ShowPost.aspx?PostID=1579232&amp;SiteID=1&amp;pageid=0</span></a>
</p>
<p>
<a class="ext-link" href="http://msdn.microsoft.com/en-us/library/aa970909.aspx"><span class="icon">http://msdn.microsoft.com/en-us/library/aa970909.aspx</span></a>
</p>
<p>
<a class="ext-link" href="http://www.ddj.com/windows/209800469"><span class="icon">http://www.ddj.com/windows/209800469</span></a>
</p>
<p>
DataBinding:
</p>
<p>
<a class="ext-link" href="http://blog.spencen.com/2008/01/19/html-to-flowdocument-converter.aspx"><span class="icon">http://blog.spencen.com/2008/01/19/html-to-flowdocument-converter.aspx</span></a>
</p>
<p>
<a class="ext-link" href="http://code.logos.com/blog/2008/01/data_binding_in_a_flowdocument.html"><span class="icon">http://code.logos.com/blog/2008/01/data_binding_in_a_flowdocument.html</span></a>
</p>
<p>
Spell checking:
</p>
<p>
<a class="ext-link" href="http://www.dev102.com/2008/03/25/customize-spellcheck-on-wpf-text-controls/"><span class="icon">http://www.dev102.com/2008/03/25/customize-spellcheck-on-wpf-text-controls/</span></a>
<a class="ext-link" href="http://www.codeproject.com/KB/WPF/SmartTextBox.aspx"><span class="icon">http://www.codeproject.com/KB/WPF/SmartTextBox.aspx</span></a>
</p>
<p>
Customizing RichTextBox:
</p>
<p>
<a class="ext-link" href="http://msdn.microsoft.com/en-us/library/ms753314.aspx"><span class="icon">http://msdn.microsoft.com/en-us/library/ms753314.aspx</span></a>
</p>
<p>
Several tips, particularly for selecting content programmatically:
</p>
<p>
<a class="ext-link" href="http://blogs.msdn.com/prajakta/"><span class="icon">http://blogs.msdn.com/prajakta/</span></a>
</p>
<p>
Scroll into view:
</p>
<p>
<a class="ext-link" href="http://statestreetgang.net/post/2008/05/Scroll-Selected-Text-Into-View-in-WPF.aspx"><span class="icon">http://statestreetgang.net/post/2008/05/Scroll-Selected-Text-Into-View-in-WPF.aspx</span></a>
</p>
<p>
Typography things:
</p>
<p>
<a class="ext-link" href="http://blogs.msdn.com/text/"><span class="icon">http://blogs.msdn.com/text/</span></a>
</p>
<p>
<a class="ext-link" href="http://fortes.com/2005/10/number-substitution/"><span class="icon">http://fortes.com/2005/10/number-substitution/</span></a>
</p>
<p>
Mouse click/hover detection:
</p>
<p>
<a class="ext-link" href="http://blogs.microsoft.co.il/blogs/justinangel/archive/2008/01/29/tapuz-net-getting-wpf-s-flowdocument-and-flowdoucmentreader-mouseover-text.aspx"><span class="icon">http://blogs.microsoft.co.il/blogs/justinangel/archive/2008/01/29/tapuz-net-getting-wpf-s-flowdocument-and-flowdoucmentreader-mouseover-text.aspx</span></a>
</p>
<p>
Bindable Run:
</p>
<p>
<a class="ext-link" href="http://fortes.com/2007/03/20/bindablerun/"><span class="icon">http://fortes.com/2007/03/20/bindablerun/</span></a>
</p>
<p>
<a class="ext-link" href="http://www.paulstovell.com/blog/attached-bindablerun"><span class="icon">http://www.paulstovell.com/blog/attached-bindablerun</span></a>
</p>
<p>
<a class="ext-link" href="http://code.logos.com/blog/2008/01/data_binding_in_a_flowdocument.html"><span class="icon">http://code.logos.com/blog/2008/01/data_binding_in_a_flowdocument.html</span></a>
</p>
<p>
Pagination:
</p>
<p>
<a class="ext-link" href="http://forums.msdn.microsoft.com/en-US/wpf/thread/bc71bfd3-b456-4de2-8ac8-70f1d46bcb06"><span class="icon">http://forums.msdn.microsoft.com/en-US/wpf/thread/bc71bfd3-b456-4de2-8ac8-70f1d46bcb06</span></a>
</p>
<p>
Templating:
</p>
<p>
<a class="ext-link" href="http://janrep.blog.codeplant.net/WPF-Multipage-Reports--Part-III--Rendering.aspx"><span class="icon">http://janrep.blog.codeplant.net/WPF-Multipage-Reports--Part-III--Rendering.aspx</span></a>
</p>
<p>
Neat/quick summary of content model:
</p>
<p>
<a class="ext-link" href="http://fortes.com/2007/03/inline-elements/"><span class="icon">http://fortes.com/2007/03/inline-elements/</span></a>
</p>
<p>
<a class="ext-link" href="http://fortes.com/2007/03/inline-properties/"><span class="icon">http://fortes.com/2007/03/inline-properties/</span></a>
</p>
<p>
<a class="ext-link" href="http://fortes.com/2007/04/block-elements/"><span class="icon">http://fortes.com/2007/04/block-elements/</span></a>
</p>
<p>
White spaces around Run:
</p>
<p>
<a class="ext-link" href="http://fortes.com/2007/03/collapsed-spaces-around-run/"><span class="icon">http://fortes.com/2007/03/collapsed-spaces-around-run/</span></a>
</p>
<p>
Tree walking the FlowDocument + pagination:
</p>
<p>
<a class="ext-link" href="http://janrep.blog.codeplant.net/WPF-Multipage-Reports--Part-IV--Pagination.aspx"><span class="icon">http://janrep.blog.codeplant.net/WPF-Multipage-Reports--Part-IV--Pagination.aspx</span></a>
</p>
<p>
Undo/Redo in <a class="missing wiki" href="http://daisy-trac.cvsdude.com/tobi/wiki/RichTextBox" rel="nofollow">RichTextBox?</a>:
</p>
<p>
The underlying <a class="missing wiki" href="http://daisy-trac.cvsdude.com/tobi/wiki/FlowDocument" rel="nofollow">FlowDocument?</a> data model is completely
decoupled from the editor (for example, it could be used in a totally
different read-only viewer), and yet *any* change of property in the
data model is registered by the undo/redo manager. There is also
support for the equivalent of our Transactions:
</p>
<hr />
<blockquote>
<p>
<a class="missing wiki" href="http://daisy-trac.cvsdude.com/tobi/wiki/TextPointer" rel="nofollow">TextPointer?</a> startPosition = richTextBox.Selection.Start;
</p>
</blockquote>
<blockquote>
<p>
// below: 3 consecutive changes, registered sequentially in the
</p>
</blockquote>
<p>
undo/redo manager
</p>
<blockquote>
<p>
Run r = new Run("bold line of text", startPosition); // inserts the
</p>
</blockquote>
<p>
new text Run into the <a class="missing wiki" href="http://daisy-trac.cvsdude.com/tobi/wiki/RichTextBox" rel="nofollow">RichTextBox?</a> at the given position
</p>
<blockquote>
<p>
r.<a class="missing wiki" href="http://daisy-trac.cvsdude.com/tobi/wiki/FontWeight" rel="nofollow">FontWeight?</a> = <a class="missing wiki" href="http://daisy-trac.cvsdude.com/tobi/wiki/FontWeights" rel="nofollow">FontWeights?</a>.Bold; // changes a property of the Run
r.Background = Brushes.Yellow; // changes another property of the Run
</p>
</blockquote>
<hr />
<p>
To register these 3 operations as one macro-command (and there to be
able to undo in one CTRL-Z only), here is what you do (similar to our
Transactions):
</p>
<p>
// wraps the undo-redo registration using a code block {}
using(richTextBox.<a class="missing wiki" href="http://daisy-trac.cvsdude.com/tobi/wiki/DeclareChangeBlock" rel="nofollow">DeclareChangeBlock?</a>())
{
...
}
</p>
<hr />
<p>
or
</p>
<hr />
<p>
// wraps the undo-redo registration using 'begin' and 'end'
richTextBox.<a class="missing wiki" href="http://daisy-trac.cvsdude.com/tobi/wiki/BeginChange" rel="nofollow">BeginChange?</a>();
...
richTextBox.<a class="missing wiki" href="http://daisy-trac.cvsdude.com/tobi/wiki/EndChange" rel="nofollow">EndChange?</a>();
</p>
</body></html>